{% extends "base.html" %}
{% block title %}Профайл{% endblock %}

{% block content %}
{% include "partials/slide_detail.html" with title="Профайл" %}
<div class="container py-5">
  <div class="row g-4">
    <div class="col-lg-7 col-xl-6">

      <div class="card shadow-sm mb-4">
        <div class="card-body">

          <div class="text-center mb-4">

            {% if profile.profile_picture %}
            <img src="{{ profile.profile_picture }}" alt="Profile picture" class="rounded-circle shadow-sm"
              style="width:120px; height:120px; object-fit:cover;">
            {% else %}
            <div
              class="rounded-circle bg-secondary text-white d-flex align-items-center justify-content-center mx-auto shadow-sm"
              style="width:120px; height:120px; font-size:2rem;">
              {{ profile.user.username|slice:":1"|upper }}
            </div>
            {% endif %}

            {% if profile.bio %}
            <p class="mt-3 mb-1">
              {{ profile.bio }}
            </p>
            {% else %}
            <p class="mt-3 mb-1 text-muted">
              Bio мэдээлэл хараахан оруулаагүй байна.
            </p>
            {% endif %}
          </div>

          <form method="post" novalidate>
            {% csrf_token %}

            <div class="mb-3">
              <label class="form-label">{{ form.profile_picture.label }}</label>
              {{ form.profile_picture }}
            </div>

            <div class="mb-3">
              <label class="form-label">{{ form.bio.label }}</label>
              {{ form.bio }}
            </div>

            <div class="mb-3">
              <label class="form-label">{{ form.phone_number.label }}</label>
              {{ form.phone_number }}
            </div>

            <div class="mb-3">
              <label class="form-label">{{ form.subscription_level.label }}</label>
              {{ form.subscription_level }}
            </div>

            <div class="mb-3">
              <label class="form-label">{{ form.social_links.label }}</label>
              {{ form.social_links }}
            </div>

            <a href="{% url 'profile_edit' %}" class="btn btn-primary w-100 mt-2">
              Засах
            </a>
          </form>

        </div>
      </div>

    </div>

    <div class="col-lg-5 col-xl-4">

      <div class="card shadow-sm mb-3">
        <div class="card-body">
          <h2 class="h6 text-uppercase text-muted mb-3">
            Товч хэрэглэгчийн мэдээлэл
          </h2>

          <p class="mb-1">
            <strong>Нэр:</strong>
            {{ profile.user.username }}
          </p>

          <p class="mb-1">
            <strong>И-мэйл:</strong>
            {{ profile.user.email|default:"И-мэйл бүртгэлгүй" }}
          </p>

          <p class="mb-1">
            <strong>Бүртгүүлсэн огноо:</strong>
            {{ profile.user.date_joined|date:"Y-m-d" }}
          </p>

          <p class="mb-1">
            <strong>Сүүлд нэвтэрсэн:</strong>
            {{ profile.user.last_login|date:"Y-m-d H:i" }}
          </p>

          <p class="mb-1">
            <strong>Гишүүнчлэл:</strong>
            {% if profile.subscription_level %}
            {{ profile.get_subscription_level_display }}
            {% else %}
            Free
            {% endif %}
          </p>

          <p class="mb-0">
            <strong>Утас:</strong>
            {{ profile.phone_number|default:"Утасны мэдээлэл байхгүй" }}
          </p>
        </div>
      </div>

      <div class="card shadow-sm mb-3">
        <div class="card-body">
          <h2 class="h6 text-uppercase text-muted mb-3">
            Миний оруулсан хичээлүүд
          </h2>

          <p class="mb-2">
            <strong>Нийт:</strong>
            {{ profile.user.courses.count }}
          </p>

          {% if profile.user.courses.exists %}
          <ul class="small mb-0">
            {% for course in profile.user.courses.all|slice:":3" %}
            <li>
              <a href="{% url 'course_detail' course.pk %}">
                {{ course.title }}
              </a>
            </li>
            {% endfor %}
          </ul>
          {% if profile.user.courses.count > 3 %}
          <p class="small text-muted mt-1 mb-0">
            … ба бусад (сургалт хэсгээс бүгдийг харах боломжтой)
          </p>
          {% endif %}
          {% else %}
          <p class="small text-muted mb-0">
            Та одоогоор ямар ч хичээл нэмээгүй байна.
            <a href="{% url 'course_create' %}">
              Эхний сургалтаа үүсгэх
            </a>
          </p>
          {% endif %}
        </div>
      </div>

      <div class="card shadow-sm">
        <div class="card-body small">
          <h2 class="h6 text-uppercase text-muted mb-3">
            Социал линкүүд
          </h2>

          {% if profile.social_links %}
          <pre class="mb-2" style="white-space: pre-wrap;">{{ profile.social_links }}</pre>
          {% else %}
          <p class="text-muted mb-0">
            Одоогоор социал линк оруулаагүй байна. Facebook, Instagram, LinkedIn гэх мэт линкүүдээ доорх талбарт бичиж
            хадгалаарай.
          </p>
          {% endif %}
        </div>
      </div>

    </div>
  </div>

</div>
{% endblock %}