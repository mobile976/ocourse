{% extends "base.html" %}
{% block title %}Courses ¬∑ E-Learning{% endblock %}
{% block hero %}
{% include "partials/slide.html" %}
{% load static %}
<link rel="stylesheet" href="{% static 'css/course_list.css' %}">
<section class="py-4 hero-section border-bottom">
  <div class="container">
    <div class="row align-items-center gy-3">
      <div class="col-lg-7">
        <h1 class="fw-semibold mb-3">–°—É—Ä–≥–∞–ª—Ç—ã–Ω –∂–∞–≥—Å–∞–∞–ª—Ç</h1>
        <p class="lead text-body-secondary mb-3">
          –û–Ω–ª–∞–π–Ω —Å—É—Ä–≥–∞–ª—Ç—É—É–¥—ã–≥ –Ω—ç–≥ –¥–æ—Ä —Ü—ç–≥—Ü—Ç—ç–π–≥—ç—ç—Ä —Ö–∞—Ä—É—É–ª–∂, –Ω—ç–≤—Ç—ç—Ä—Å—ç–Ω —Ö—ç—Ä—ç–≥–ª—ç–≥—á–¥—ç–¥ ”©”©—Ä–∏–π–Ω —Ö–∏—á—ç—ç–ª–∏–π–≥ “Ø“Ø—Å–≥—ç—Ö –±–æ–ª–æ–Ω
          –∑–∞—Å–≤–∞—Ä–ª–∞—Ö –±–æ–ª–æ–º–∂–∏–π–≥ –æ–ª–≥–æ–¥–æ–≥.
        </p>

        {% if user.is_authenticated %}
        <div class="d-flex flex-wrap gap-2 mb-2">
          <a href="{% url 'course_create' %}" class="btn btn-primary px-4">
            + –®–∏–Ω—ç —Ö–∏—á—ç—ç–ª “Ø“Ø—Å–≥—ç—Ö
          </a>
          <a href="{% url 'my_courses' %}" class="btn btn-outline-secondary px-4">
            –ú–∏–Ω–∏–π –æ—Ä—É—É–ª—Å–∞–Ω —Ö–∏—á—ç—ç–ª“Ø“Ø–¥
          </a>
        </div>
        {% else %}
        <div class="d-flex flex-wrap gap-2 mb-2">
          <a href="{% url 'login' %}" class="btn btn-primary px-4">
            –ù—ç–≤—Ç—Ä—ç—Ö
          </a>
          <a href="{% url 'register' %}" class="btn btn-outline-secondary px-4">
            –ë“Ø—Ä—Ç–≥“Ø“Ø–ª—ç—Ö
          </a>
        </div>
        <small class="text-body-secondary">
          –•–∏—á—ç—ç–ª –Ω—ç–º—ç—Ö –±–æ–ª —ç—Ö–ª—ç—ç–¥ –Ω—ç–≤—Ç—ç—Ä—á —ç—Å–≤—ç–ª –±“Ø—Ä—Ç–≥“Ø“Ø–ª–Ω—ç “Ø“Ø.
        </small>
        {% endif %}
      </div>

      <div class="col-lg-5">
        <div class="card course-toolbar-card shadow-sm border-0 mt-3 mt-lg-0">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <div>
                <div class="small text-body-secondary mb-1">–ù–∏–π—Ç —Å—É—Ä–≥–∞–ª—Ç</div>
                <div class="h5 mb-0">
                  {{ courses|length|default:"0" }}
                  <span class="fs-6 text-body-secondary">—Ö–∏—á—ç—ç–ª</span>
                </div>
              </div>
              <span class="badge rounded-pill text-bg-primary-subtle text-primary-emphasis">
                üìö –¶–∞—Ö–∏–º —Å—É—Ä–≥–∞–ª—Ç
              </span>
            </div>

            <form method="get" class="row g-2">

              <div class="col-12">
                <div class="input-group input-group-sm">
                  <span class="input-group-text border-end-0 bg-transparent">
                    üîç
                  </span>
                  <input type="text" name="q" class="form-control border-start-0" placeholder="–•–∏—á—ç—ç–ª —Ö–∞–π—Ö..."
                    value="{{ search_query }}">
                </div>
              </div>

              <div class="col-6">
                <select name="order" class="form-select form-select-sm">
                  <option value="">–≠—Ä—ç–º–±—ç–ª—ç—Ö</option>
                  <option value="new" {% if selected_order == "new" %}selected{% endif %}>
                    –®–∏–Ω—ç (—à–∏–Ω–∏–π–≥ —ç—Ö—ç–Ω–¥)
                  </option>
                  <option value="old" {% if selected_order == "old" %}selected{% endif %}>
                    –•—É—É—á–∏–Ω (—Ö—É—É—á–Ω—ã–≥ —ç—Ö—ç–Ω–¥)
                  </option>
                </select>
              </div>

              <div class="col-6">
                <select name="duration" class="form-select form-select-sm">
                  <option value="">–•—É–≥–∞—Ü–∞–∞</option>
                  <option value="short" {% if selected_duration == "short" %}selected{% endif %}>–ë–æ–≥–∏–Ω–æ</option>
                  <option value="long"  {% if selected_duration == "long" %}selected{% endif %}>–£—Ä—Ç</option>
                </select>
              </div>

              <div class="col-12 text-end">
                <button type="submit" class="btn btn-sm btn-outline-primary">
                  –•–∞–π—Ö / –≠—Ä—ç–º–±—ç–ª—ç—Ö
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
{% endblock hero %}

{% block content %}
<div class="container py-4">
  {% if courses %}
  <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-4">
    {% for course in courses %}
    <div class="col">
      <div class="card h-100 course-card">

        <div class="course-card-img-wrapper">
          {% if course.image_url %}
          <img src="{{ course.image_url }}" alt="{{ course.title }}" />
          {% else %}
          <svg class="bd-placeholder-img" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Thumbnail"
            preserveAspectRatio="xMidYMid slice" focusable="false">
            <title>{{ course.title }}</title>
            <rect width="100%" height="100%" fill="#1f2937"></rect>
            <text x="50%" y="50%" fill="#e5e7eb" dy=".3em" text-anchor="middle">
              {{ course.title|truncatechars:22 }}
            </text>
          </svg>
          {% endif %}

          <div class="course-card-overlay-gradient"></div>

          <div class="course-card-meta-top">
            <span class="badge-soft-light">
              üóì {{ course.created_at|date:"Y-m-d" }}
            </span>

            {% if course.duration %}
            <span class="badge-soft">
              ‚è± {{ course.duration }}
            </span>
            {% endif %}
          </div>

          <div class="course-card-meta-bottom">
            <span class="badge-soft-light course-owner-chip">
              üë§ {{ course.owner.username }}
            </span>

            {% if user.is_authenticated and course.owner == user %}
            <span class="badge-soft course-owner-chip">
              ‚≠ê –ú–∏–Ω–∏–π –æ—Ä—É—É–ª—Å–∞–Ω —Ö–∏—á—ç—ç–ª
            </span>
            {% endif %}
          </div>
        </div>

        <div class="card-body d-flex flex-column">
          <h5 class="card-title mb-2">
            {{ course.title }}
          </h5>

          {% if course.short_description %}
          <p class="card-text mb-3 text-body-secondary">
            {{ course.short_description|truncatewords:22 }}
          </p>
          {% endif %}

          <div class="mt-auto d-flex justify-content-between align-items-center pt-2 border-top">
            <div class="btn-group">
              <a href="{% url 'course_detail' course.pk %}" class="btn btn-sm btn-outline-secondary">
                –î—ç–ª–≥—ç—Ä—ç–Ω–≥“Ø–π
              </a>
              {% if user.is_authenticated and course.owner == user %}
              <a href="{% url 'course_update' course.pk %}" class="btn btn-sm btn-outline-secondary">
                –ó–∞—Å–∞—Ö
              </a>
              {% endif %}
            </div>

            <div class="d-flex flex-column align-items-end">

              {% if course.category %}
              <span class="badge rounded-pill text-bg-primary mb-1">
                {{ course.category.name }}
              </span>
              {% endif %}

              <small class="text-body-secondary">
                ID #{{ course.pk }}
              </small>
            </div>
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <div class="alert alert-info">
    –¢–∞–Ω—ã —Ö–∞–π–ª—Ç –æ–ª–¥—Å–æ–Ω–≥“Ø–π.
    {% if user.is_authenticated %}
    –≠—Ö–Ω–∏–π —Ö–∏—á—ç—ç–ª–∏–π–≥
    <a href="{% url 'course_create' %}">—ç–Ω–¥ –¥–∞—Ä–∂ “Ø“Ø—Å–≥—ç–Ω—ç “Ø“Ø</a>.
    {% else %}
    –≠—Ö–ª—ç—ç–¥ <a href="{% url 'login' %}">–Ω—ç–≤—Ç—ç—Ä—á</a> —ç—Å–≤—ç–ª
    <a href="{% url 'register' %}">–±“Ø—Ä—Ç–≥“Ø“Ø–ª—ç—ç–¥</a> —Ö–∏—á—ç—ç–ª –Ω—ç–º—ç—ç—Ä—ç–π.
    {% endif %}
  </div>
  {% endif %}
</div>
{% endblock %}